{
    "info": {
        "_postman_id": "f1e2d3c4-b5a6-4789-0123-456789abcdef",
        "name": "RetailSync - Cycle Complet",
        "description": "# RetailSync - Collection Postman\n\nCette collection montre le cycle complet de RetailSync à travers les 3 APIs web (REST, GraphQL, SOAP). Chaque requête contient des tests automatiques pour vérifier que tout fonctionne.\n\n## Comment l'utiliser\n\n1. Importez cette collection et l'environnement `RetailSync_Environment.json` dans Postman.\n2. Lancez les 3 serveurs (voir README.md).\n3. Sélectionnez l'environnement **RetailSync - Local** en haut à droite.\n4. Cliquez sur **Run Collection** pour tout tester d'un coup.\n\n## Module gRPC (Entrepôt)\n\nPostman gère gRPC séparément. Pour le tester :\n\n### Étape 1 : Créer une requête gRPC\n- Cliquez sur **New** > **gRPC Request**.\n- URL du serveur : `localhost:50051` (sans `http://`).\n\n### Étape 2 : Importer le fichier Proto\n- Dans **Service definition**, cliquez sur **Import .proto file**.\n- Choisissez `logistics/contracts/warehouse.proto`.\n\n### Étape 3 : Tester GetRobotStatus (Une seule réponse)\n- Choisissez **WarehouseAutomation / GetRobotStatus**.\n- Dans l'onglet **Message**, tapez :\n```json\n{\n  \"robot_id\": \"ROBOT-P01-A\"\n}\n```\n- Cliquez sur **Invoke**.\n\n### Étape 4 : Tester StreamTelemetry (En continu)\n- Choisissez **WarehouseAutomation / StreamTelemetry**.\n- Tapez le premier message de commande :\n```json\n{\n  \"robot_id\": \"ROBOT-P01-A\",\n  \"command\": \"COMMAND_MOVE\",\n  \"target\": { \"x\": 15.0, \"y\": 12.0, \"z\": 0.0 },\n  \"timestamp_ms\": 1740564000000\n}\n```\n- Cliquez sur **Send**.\n- Le serveur va répondre avec 3 messages de position. Cliquez sur **End streaming** pour terminer.",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
        {
            "name": "Module 1 : REST - Boutiques Partenaires",
            "description": "Teste l'API REST utilisée par les boutiques pour gérer leur stock. Démontre les requêtes GET (lecture) et PATCH (mise à jour simple).",
            "item": [
                {
                    "name": "GET - Voir tout l'inventaire",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl_rest}}/inventory",
                            "host": [
                                "{{baseUrl_rest}}"
                            ],
                            "path": [
                                "inventory"
                            ]
                        },
                        "description": "Récupère tout le catalogue. Montre que REST est simple : un GET sur la collection renvoie tous les objets."
                    },
                    "response": [],
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response time is under 200ms', function () {",
                                    "    pm.expect(pm.response.responseTime).to.be.below(200);",
                                    "});",
                                    "",
                                    "pm.test('Response is a non-empty JSON array', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.be.an('array');",
                                    "    pm.expect(jsonData.length).to.be.above(0);",
                                    "});",
                                    "",
                                    "pm.test('First item contains the expected SKU', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    var sku = pm.environment.get('current_sku');",
                                    "    var found = jsonData.some(function (item) {",
                                    "        return item.sku === sku;",
                                    "    });",
                                    "    pm.expect(found).to.be.true;",
                                    "});",
                                    "",
                                    "pm.test('Each item has required fields', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    jsonData.forEach(function (item) {",
                                    "        pm.expect(item).to.have.property('sku');",
                                    "        pm.expect(item).to.have.property('name');",
                                    "        pm.expect(item).to.have.property('category');",
                                    "        pm.expect(item).to.have.property('quantity');",
                                    "        pm.expect(item).to.have.property('price_cents');",
                                    "        pm.expect(item).to.have.property('store_id');",
                                    "    });",
                                    "});"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "GET - Un seul produit",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl_rest}}/inventory/{{current_sku}}",
                            "host": [
                                "{{baseUrl_rest}}"
                            ],
                            "path": [
                                "inventory",
                                "{{current_sku}}"
                            ]
                        },
                        "description": "Récupère un seul produit. Le nom du produit (SKU) fait partie de l'URL, c'est le principe central de REST."
                    },
                    "response": [],
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response time is under 200ms', function () {",
                                    "    pm.expect(pm.response.responseTime).to.be.below(200);",
                                    "});",
                                    "",
                                    "pm.test('Response body contains the correct SKU', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    var sku = pm.environment.get('current_sku');",
                                    "    pm.expect(jsonData.sku).to.eql(sku);",
                                    "});",
                                    "",
                                    "pm.test('Item has all required fields', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('name');",
                                    "    pm.expect(jsonData).to.have.property('category');",
                                    "    pm.expect(jsonData).to.have.property('quantity');",
                                    "    pm.expect(jsonData).to.have.property('price_cents');",
                                    "    pm.expect(jsonData).to.have.property('store_id');",
                                    "});"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "PATCH - Mettre à jour la quantité",
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"quantity\": 75\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl_rest}}/inventory/{{current_sku}}",
                            "host": [
                                "{{baseUrl_rest}}"
                            ],
                            "path": [
                                "inventory",
                                "{{current_sku}}"
                            ]
                        },
                        "description": "Met à jour une partie de l'objet. On utilise PATCH (et non PUT) car on n'envoie que la quantité qui change, pour économiser internet."
                    },
                    "response": [],
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response time is under 200ms', function () {",
                                    "    pm.expect(pm.response.responseTime).to.be.below(200);",
                                    "});",
                                    "",
                                    "pm.test('Response body contains the correct SKU', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    var sku = pm.environment.get('current_sku');",
                                    "    pm.expect(jsonData.sku).to.eql(sku);",
                                    "});",
                                    "",
                                    "pm.test('Quantity has been updated to 75', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.quantity).to.eql(75);",
                                    "});"
                                ]
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "Module 2 : GraphQL - Tableau de bord du Gérant",
            "description": "Teste l'API GraphQL. Une seule requête permet de récupérer les infos des magasins, leur stock, et leurs commandes en même temps.",
            "item": [
                {
                    "name": "Requête - Magasins, Stock et Commandes",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"query\": \"{ stores { id name city country inventory { sku name category quantity priceCents } orders { id supplierId status totalPriceCents itemCount orderDate estimatedDelivery } } }\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl_graphql}}/graphql",
                            "host": [
                                "{{baseUrl_graphql}}"
                            ],
                            "path": [
                                "graphql"
                            ]
                        },
                        "description": "Envoie une seule requête GraphQL qui récupère absolument toutes les informations liées au magasin."
                    },
                    "response": [],
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response time is under 200ms', function () {",
                                    "    pm.expect(pm.response.responseTime).to.be.below(200);",
                                    "});",
                                    "",
                                    "pm.test('Response contains data object', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('data');",
                                    "});",
                                    "",
                                    "pm.test('No GraphQL errors returned', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.not.have.property('errors');",
                                    "});",
                                    "",
                                    "pm.test('Stores array is present and non-empty', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.data.stores).to.be.an('array');",
                                    "    pm.expect(jsonData.data.stores.length).to.be.above(0);",
                                    "});",
                                    "",
                                    "pm.test('First store has nested inventory array', function () {",
                                    "    var store = pm.response.json().data.stores[0];",
                                    "    pm.expect(store.inventory).to.be.an('array');",
                                    "    pm.expect(store.inventory.length).to.be.above(0);",
                                    "});",
                                    "",
                                    "pm.test('First store has nested orders array', function () {",
                                    "    var store = pm.response.json().data.stores[0];",
                                    "    pm.expect(store.orders).to.be.an('array');",
                                    "    pm.expect(store.orders.length).to.be.above(0);",
                                    "});"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "Requête - Statistiques globales",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"query\": \"{ dashboardSummary { totalStores totalSkus totalOrdersPending totalRobotsActive lowStockAlerts { sku name quantity } } }\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl_graphql}}/graphql",
                            "host": [
                                "{{baseUrl_graphql}}"
                            ],
                            "path": [
                                "graphql"
                            ]
                        },
                        "description": "Récupère les statistiques globales (KPI) et les produits en rupture de stock en une seule requête."
                    },
                    "response": [],
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response time is under 200ms', function () {",
                                    "    pm.expect(pm.response.responseTime).to.be.below(200);",
                                    "});",
                                    "",
                                    "pm.test('Dashboard summary contains expected KPIs', function () {",
                                    "    var summary = pm.response.json().data.dashboardSummary;",
                                    "    pm.expect(summary).to.have.property('totalStores');",
                                    "    pm.expect(summary).to.have.property('totalSkus');",
                                    "    pm.expect(summary).to.have.property('totalOrdersPending');",
                                    "    pm.expect(summary).to.have.property('totalRobotsActive');",
                                    "});",
                                    "",
                                    "pm.test('Low stock alerts is an array', function () {",
                                    "    var summary = pm.response.json().data.dashboardSummary;",
                                    "    pm.expect(summary.lowStockAlerts).to.be.an('array');",
                                    "});"
                                ]
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "Module 3 : SOAP - Commandes Usines B2B",
            "description": "Teste le service SOAP très ancien utilisé pour envoyer des commandes formelles aux usines.",
            "item": [
                {
                    "name": "SubmitOrder - Envoyer la commande à l'usine",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/xml"
                            },
                            {
                                "key": "SOAPAction",
                                "value": "http://retailsync.retail/procurement/SubmitOrder"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<soapenv:Envelope\n    xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"\n    xmlns:proc=\"http://retailsync.retail/procurement\">\n    <soapenv:Header/>\n    <soapenv:Body>\n        <proc:SubmitOrder>\n            <proc:order>\n                <proc:order_id>PO-2026-0042</proc:order_id>\n                <proc:buyer_org_id>OMNI-RETAIL-EU</proc:buyer_org_id>\n                <proc:supplier_org_id>MFG-SHENZHEN-008</proc:supplier_org_id>\n                <proc:order_date>2026-02-26</proc:order_date>\n                <proc:currency>EUR</proc:currency>\n                <proc:items>\n                    <proc:OrderItem>\n                        <proc:sku>SKU-JACKET-BLK-L</proc:sku>\n                        <proc:product_name>Urban Wool Jacket - Black, Large</proc:product_name>\n                        <proc:quantity>500</proc:quantity>\n                        <proc:unit_price_cents>4500</proc:unit_price_cents>\n                        <proc:manufacturing_id>MFG-SZ-20260101-A</proc:manufacturing_id>\n                    </proc:OrderItem>\n                    <proc:OrderItem>\n                        <proc:sku>SKU-SNEAKER-WHT-42</proc:sku>\n                        <proc:product_name>RetroFlex Sneaker - White, EU 42</proc:product_name>\n                        <proc:quantity>1200</proc:quantity>\n                        <proc:unit_price_cents>3200</proc:unit_price_cents>\n                        <proc:manufacturing_id>MFG-SZ-20260101-B</proc:manufacturing_id>\n                    </proc:OrderItem>\n                </proc:items>\n            </proc:order>\n        </proc:SubmitOrder>\n    </soapenv:Body>\n</soapenv:Envelope>"
                        },
                        "url": {
                            "raw": "{{baseUrl_soap}}",
                            "host": [
                                "{{baseUrl_soap}}"
                            ]
                        },
                        "description": "Envoie l'imposant fichier XML qui contient la commande, exactement comme l'usine (et le contrat WSDL) l'attend."
                    },
                    "response": [],
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response time is under 200ms', function () {",
                                    "    pm.expect(pm.response.responseTime).to.be.below(200);",
                                    "});",
                                    "",
                                    "pm.test('Response is valid XML', function () {",
                                    "    pm.response.to.have.header('Content-Type');",
                                    "    var contentType = pm.response.headers.get('Content-Type');",
                                    "    pm.expect(contentType).to.include('xml');",
                                    "});",
                                    "",
                                    "pm.test('Response contains confirmation_id', function () {",
                                    "    var body = pm.response.text();",
                                    "    pm.expect(body).to.include('confirmation_id');",
                                    "});",
                                    "",
                                    "pm.test('Order status is ACCEPTED', function () {",
                                    "    var body = pm.response.text();",
                                    "    pm.expect(body).to.include('ACCEPTED');",
                                    "});",
                                    "",
                                    "pm.test('Response contains estimated delivery date', function () {",
                                    "    var body = pm.response.text();",
                                    "    pm.expect(body).to.include('estimated_delivery');",
                                    "});",
                                    "",
                                    "pm.test('Response contains total price', function () {",
                                    "    var body = pm.response.text();",
                                    "    pm.expect(body).to.include('total_price_cents');",
                                    "});"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "GetRecentOrders - Voir l'historique (Nouveau)",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "text/xml"
                            },
                            {
                                "key": "SOAPAction",
                                "value": "http://retailsync.retail/procurement/GetRecentOrders"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:proc=\"http://retailsync.retail/procurement\">\n   <soapenv:Header/>\n   <soapenv:Body>\n      <proc:GetRecentOrdersRequestMsg>\n         <proc:request>\n            <proc:storeId>STORE-PARIS-01</proc:storeId>\n         </proc:request>\n      </proc:GetRecentOrdersRequestMsg>\n   </soapenv:Body>\n</soapenv:Envelope>"
                        },
                        "url": {
                            "raw": "{{baseUrl_soap}}",
                            "host": [
                                "{{baseUrl_soap}}"
                            ]
                        },
                        "description": "Nouvelle opération ajoutée pour que GraphQL puisse interroger l'historique SOAP des commandes d'un magasin spécifique."
                    },
                    "response": [],
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response contains PO number', function () {",
                                    "    var body = pm.response.text();",
                                    "    pm.expect(body).to.include('PO-2026-STORE');",
                                    "});"
                                ]
                            }
                        }
                    ]
                }
            ]
        }
    ]
}